<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"    content="width=device-width">
    <meta name="author"      content="M A Eyler, Istanbul, 2020" />
    <meta name="description" content="Reader for the Quran" />
    <link rel="icon" href="image/icon.png">
    <title>Kuran-ı Kerim </title>

  <style>
    body {
      min-height: 90vh;
    }
    #dataDiv {
      max-width: 420px;
      background: #f9f4e8;
      margin: auto;
      padding: 12px;
    }
    body, h2, h3 { margin: 12px; }
    h2 {
      margin-bottom: 16px;
      text-align: center;
      font-family: Zekr, serif;
    }
    @font-face {
      font-family: Zekr;
      src: url("/Rehber/style/ZEKRQURAN.TTF");
    }
    body, input, button { 
      font: 16px arial;
    }
    #text, #omni { width: 90%; max-width: 340px; }
    #page, #root { width: 130px; }
    button {
      border: 3px solid gray;
      border-radius: 8px;
      cursor: pointer;
      background: lightgray;
    }
    .group button {
      min-width: 84px;
    }
    .yellow { background: #ff7; }
    .white { background: white; }
    .small { font-size: smaller; }
    .expert { color: darkred; }
    #star {
      position: relative;
      top: 10px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-image: url(image/star.png);
      background-size: contain;
      background-repeat: no-repeat;
    }
  </style>
</head>

<body>

<h2 id=head title='innehû lequr-ânun kerîm &#010;fî kitâbin meknûn'></h2>

<div id=dataDiv>
  <div id=intro></div>
  <hr />
  <p><label id=lab1></label><br>
  <input type=text id=page inputmode=decimal>&emsp; 
  <button id=star></button>&nbsp;
  <button id=last>
    <span id=lastText></span> <span id=lastPage></span>
  </button>&nbsp;
  </p>
  <p><label id=lab2></label><br>
  <input type=text id=text>
  </p>
  <p><label id=lab3></label><br>
  <input type=text id=root>&emsp;
  <button id=search></button>&nbsp;
  <button id=clear hidden></button>&nbsp;
  <button class=yellow onclick="langMgr.nextLanguage()"
      title="Change language / Dil değiştir">L</button>
  </p>
  <p class="group">
  <button id=topic onclick='location="konular.html"'></button>
  <button id=notes onclick='location="notlar.html"'></button>
  <button id=help onclick='window.open("guideQ.html","Kuran")'></button>
  </p>
  <p id=kitap class="group">
  <button id=mark onclick='location="bookmarks.html"'></button>
  <button id=days onclick='location="/Kitap/rama/"'></button>
  <button id=ders onclick='location="/Kitap/ders/"'></button>
  </p>
  <p id=offline hidden class=expert></p>
  <hr />
  <details id=expert class=expert>
    <summary id=summ>
      <button onclick="expert.open=!expert.open">?</button> 
      &ensp; For expert use only
    </summary>
  <p class=small>
    <span id=buck class=white>
    &nbsp; A b t v j H x d * r z s $ S D T Z E g f q k l m n h w y &nbsp;</span><br>
    <a href="https://en.wikipedia.org/wiki/Buckwalter_transliteration" target=Kuran>
      Buckwalter transliteration</a>
  </p>
  <p class=small><label>Link
    <span>(hashtag or URL) </span></label><br>
    <input type=text id=omni>
  </p>
  </details>
</div>

<script src="code/languages.js"></script>
<script>//localization strings
const localization = {};

localization.tr =
`head	innerText	Kuran-ı Kerim
intro	innerText	Iqra yazılımı ile Kuran-ı Kerim'i farklı yollardan keşfedin: İstenen sayfayı gösterin, aradığınız kelimeleri bulun, ya da Arapça kelime kökleri ile arayın. Aşağıda istediğiniz yöntemle başlayabilirsiniz.
lab1	innerText	Mushafta göster (Sayfa veya Sure:Ayet)
page	placeholder	378 veya 27:30
page	title	1-604 arasında sayfa numarası ya da sure-ayet numaraları
star	title	En son işaretlenen sayfa
last	title	En son açılan sayfa
lastText	innerText	Sayfa
lab2	innerText	Rehberde bul (Arapça ya da meal) 
text	placeholder	Aranacak metin
text	title	Bu alana girilen metin Rehber yazılımı ile aranır
lab3	innerText	Mucemde bul
root	placeholder	ktb Elm
root	title	Birden fazla kök aranacaksa boşluk ile ayrılmalı
search	title	Link adresini kullan
search	innerText	Bul
clear	title	Girilen verileri sil
clear	innerText	Sil
topic	innerText	Konular
notes	innerText	Notlar
help	innerText	Yardım
mark	title	Yer işaretlerini yönetin
mark	innerText	Yıldızlar
days	innerText	30 gün
ders	innerText	Dersler
offline	innerText	Internet kapalı iken bazı özellikler çalışmaz
summ	title	Buckwalter kodunu göster/gizle
buck	title	Buckwalter kodu -- alfabetik sıra
omni	title	Linki ilk harf belirler: /Mushaf: p=… v=… /Mucem: r=… /Rehber: t=… b=…/`


localization.en = 
`head	innerText	The Noble Quran
intro	innerText	Discover the Noble Quran using Iqra software: Display the desired page, search some text in the Book, or find derivatives of given roots. You may start with any method shown below.
lab1	innerText	Display in the Book
page	placeholder	378 or 27:30
page	title	Page number (1-604) or Chapter and verse numbers
star	title	Page with the latest bookmark
last	title	Page opened latest
lastText	innerText	Page
lab2	innerText	Search using Finder
text	placeholder	text to find
text	title	Text entered here will be searched verbatim using Finder
lab3	innerText	Search using Mujam
root	placeholder	ktb Elm
root	title	Use space to separate roots (in Buckwalter code)
search	title	Use the address shown in the Link below
search	innerText	Search
clear	title	Clear all data entered on this page
clear	innerText	Clear
topic	innerText	Topics
notes	innerText	Notes
help	innerText	Help
mark	title	Manage bookmarks
mark	innerText	Stars
days	innerText	30 gün
ders	innerText	Dersler
offline	innerText	Internet is required for some features
summ	title	Show/Hide Buckwalter code
buck	title	Buckwalter code -- dictionary order
omni	title	First letter determines the link: /Book: p=… v=… /Mujam: r=… /Finder: t=… b=…/`


localization.ar = 
`head	innerText	القرآن الكريم
intro	innerText	اكتشف القرآن الكريم باستخدام برنامج اقرأ: اعرض الصفحة المطلوبة ، أو ابحث عن نص في الكتاب ، أو ابحث عن مشتقات من جذور معينة. يمكنك البدء بأي طريقة مبينة أدناه.
lab1	innerText	أظهر في الكتاب
page	placeholder	378 أو 27:30
page	title	رقم الصفحة أو رقم السورة والجزء
star	title	صفحة آخر علامة 
last	title	آخر صفحة مفتوحة
lastText	innerText	صفحة
lab2	innerText	ابحث باستخدام الباحث القرآني
text	placeholder	النص المراد البحث عنه
text	title	النص المدخل هنا سيتم البحث عنه بالباحث القرآني
lab3	innerText	ابحث باستخدام المعجم
root	placeholder	كتب علم
root	title	استخدم الفراغ للفصل بين الجذور
search	title   استخدم الرابط المظاهر أدناه
search	innerText	ابحث
clear	title   إزالة جميع البيانات المدخلة في هذه الصفحة
clear	innerText	إزالة
topic	innerText	المواضيع
notes	innerText	ملاحظات
help	innerText	مساعدة
mark	title	إدارة العلامات
mark	innerText	العلامات
days	innerText	30 يوم
ders	innerText	الدورس
offline	innerText	الاتصال بالإنترنت مطلوب لبعض الميزات
summ	title	إظهار/إخفاء رمز Buckwalter
buck	title	Buckwalter code -- ترتيب القاموس
omni	title	أول حرف يشرح الرابط: /Book: p=… v=… /Mujam: r=… /Finder: t=… b=…/`

const langMgr = new LangManager( //callback on applyLanguage()
        () => LangManager.adjustDirection(dataDiv)
      )
</script>
<script src="code/common.js"></script>
<script src="code/buckwalter.js"></script>
<script>
function doRoot(h) {
    if (!h) return
    h = h.replace(/\s+/g, '&r=')
    window.open('mujam.html#'+h, 'finder')
}
function doText(h) {
    if (!h) return
    window.open(FINDER+'#'+h, 'finder')
}
function doOpen(h) {
    if (!h) return
    window.open('reader.html#'+h, 'iqra')
}
function doOmni() {
    let t = omni.value
    if (/^[vp]=/.test(t))
      doOpen(t) //t starts with v or p
    else if (/^r=/.test(t))
      doRoot(t) //t starts with r
    else if (/^[bt]=/.test(t))
      doText(t) //t starts with b or t
    else window.open(t, 'finder') //t contains URL
}
function clearAll() {
  document.querySelectorAll('input').forEach(x => x.value='')
  clear.hidden = true
}
function pageValue() {
    //find numbers, \D means not digit
    let [c, v] = page.value.split(/\D+/)
    if (v === '') v = 1
    if (v) { //c:v
      page.value = c+':'+v
      return 'v='+page.value
    } else { //page
      if (c < 1) c = '1'
      if (c>604) c = '604'
      page.value = c
      return 'p='+c
    }
}
function rootValue() {
    let r = root.value
    let b = toBuckwalter(r)
    return 'r='+(b.includes('?') ? r : b)
}
function textValue() {
    return 't='+text.value
}
function keyToPage(evt) {
    if (evt.key == 'Enter') 
      switch (evt.target) {
        case root:
          doRoot(rootValue()); break;
        case text:
          doText(textValue()); break;
        case page:
          doOpen(pageValue()); break;
        case omni:
          doOmni(); break;
      }
}
function setOmni(evt) {
    let h = ''
    if (page.value) h += '&'+pageValue()
    if (root.value) 
      h += '&'+rootValue().replace(/\s+/g, '&r=')
    if (text.value) h += '&'+textValue()
    if (!h) return
    omni.value = h.substring(1)
    clear.hidden = false
    // console.log(omni.value)
}
function init(storage = {}) {
  function hideButtons(b) {
    kitap.hidden = b; offline.hidden = !b
    console.log(b ? 'offline' : 'online')
  }
    onoffline = () => hideButtons(true)
    ononline  = () => hideButtons(false)
    hideButtons(!navigator.onLine)
    search.onclick = doOmni
    clear.onclick = clearAll
    root.onchange = setOmni
    text.onchange = setOmni
    page.onchange = setOmni
    document.onkeydown = keyToPage
    let p = storage.page
    if (p && parent.iqra && parent.iqra.curPage!=p) {
      last.onclick = () => doOpen('p='+p)
      lastPage.innerText = p
    } else {
      last.style.visibility = "hidden"
    }
    let m = storage.marks
    if (m && m.length) {
      let h = m.pop()
      star.onclick = () => doOpen('p='+h)
    } else {
      star.style.visibility = "hidden"
      mark.style.visibility = "hidden"
    }
}
document.title = head.innerText
init(getStorage('iqra'))
</script>

</body>
</html>
